
# Shutter Rank (Firebase Edition)

*Find what's cool -- cull the rest.*

Это веб-приложение для проведения фотоконкурсов со "слепым" голосованием. Эта версия интегрирована с Firebase для хранения данных в реальном времени и поддержки **нескольких независимых сессий** голосования.

## Ключевые возможности

- **Поддержка нескольких сессий**: Управляйте несколькими конкурсами в одной базе данных.
- **Доступ по URL**: Каждая сессия доступна по уникальному URL (например, `.../#session-id`).
- **5-звёздочная система рейтинга**: Участники оценивают фотографии по шкале от 1 до 5 звёзд.
- **Двойные лимиты**: Голосование ограничено как по количеству оценённых фотографий, так и по общей сумме звёзд.
- **Данные в реальном времени**: Конфигурация, список фотографий и результаты голосования хранятся в Firebase Realtime Database.
- **Сохранение голосов пользователей**: Голоса каждого пользователя сохраняются в базе данных под анонимным уникальным ID.

## Развертывание (Deployment)

Развертывание проекта полностью автоматизировано с помощью **GitHub Actions**.

1.  **Настройте секрет в GitHub**:
    *   Перейдите в настройки вашего репозитория: `Settings` > `Secrets and variables` > `Actions`.
    *   Создайте новый секрет (`New repository secret`) с именем `FIREBASE_SERVICE_ACCOUNT_PHOTO_VOTING_930F3`.
    *   Вставьте в него содержимое JSON-ключа вашего сервисного аккаунта Firebase.

2.  **Процесс развертывания**:
    *   **Тестовая среда**: Каждый `push` в ветку `firebase-integration` автоматически развернет приложение на тестовый канал `dev`.
    *   **Продакшн**: Каждый `push` в ветку `main` развернет приложение на `live` канал.

Этот метод обеспечивает надежное и предсказуемое развертывание в чистой, изолированной среде.

## Интеграция с Firebase

### Структура данных

Все данные хранятся в корневом узле `sessions`. Каждый дочерний узел представляет собой отдельную сессию голосования с уникальным ID.

```json
{
  "sessions": {
    "fontainebleau": {
      "config": { "..."},
      "photos": { "..."},
      "votes":  { "..."},
      "userVotes": {
        "уникальный-id-пользователя-1": {
          "photo_id_1": 5,
          "photo_id_27": 3
        },
        "уникальный-id-пользователя-2": {
          "photo_id_1": 4
        }
      }
    }
  }
}
```

### Настройка и миграция данных

1.  **Настройте Firebase**: Следуйте [инструкциям](https://firebase.google.com/docs/web/setup) для создания проекта и Realtime Database.

2.  **Используйте инструмент миграции**:
    *   Откройте файл `migration-tool.html` в вашем браузере.
    *   Введите **ID сессии** (например, `fontainebleau`). Этот ID будет использоваться в URL.
    *   Загрузите ваши локальные файлы `config.json`, `photos.json` и `results.json` (опционально).
    *   Инструмент сгенерирует JSON-структуру для одной сессии.
    *   Скопируйте сгенерированный JSON.

3.  **Импортируйте данные в Firebase**:
    *   Перейдите в вашу Realtime Database.
    *   Создайте корневой узел `sessions`.
    *   Внутри `sessions` создайте новый дочерний узел с вашим **ID сессии**.
    *   Импортируйте скопированный JSON в этот узел.

4.  **Настройте правила безопасности**: Для анонимного голосования установите следующие правила в вашей Realtime Database:
    ```json
    {
      "rules": {
        "sessions": {
          ".read": true,
          "$sessionId": {
            "config": { ".write": false },
            "photos": { ".write": false },
            "votes": {
              "$photo_id": { ".write": "newData.isNumber()" }
            },
            "userVotes": {
              "$userId": {
                ".write": "true",
                "$photoId": {
                  ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 5"
                }
              }
            }
          }
        }
      }
    }
    ```

5.  **Сконфигурируйте приложение**: Откройте файл `src/firebase.ts` и вставьте конфигурацию вашего веб-приложения Firebase.

### Управление данными

Управление конфигурацией и списком фотографий теперь осуществляется напрямую через **консоль Firebase**.