# Shutter Rank (Firebase Edition)

*Find what's cool -- cull the rest.*

Это веб-приложение для проведения фотоконкурсов со "слепым" голосованием. Эта версия интегрирована с Firebase для хранения данных в реальном времени и поддержки **нескольких независимых сессий** голосования.

## Ключевые возможности

- **Поддержка нескольких сессий**: Управляйте несколькими конкурсами в одной базе данных.
- **Доступ по URL**: Каждая сессия доступна по уникальному URL (например, `.../#session-id`).
- **5-звёздочная система рейтинга**: Участники оценивают фотографии по шкале от 1 до 5 звёзд.
- **Двойные лимиты**: Голосование ограничено как по количеству оценённых фотографий, так и по общей сумме звёзд.
- **Данные в реальном времени**: Конфигурация, список фотографий и результаты голосования хранятся в Firebase Realtime Database.
- **Автоматический подсчет голосов**: Голоса пользователей немедленно и атомарно обновляют общий рейтинг в базе данных.

## Интеграция с Firebase

### Структура данных

Все данные хранятся в корневом узле `sessions`. Каждый дочерний узел представляет собой отдельную сессию голосования с уникальным ID.

```json
{
  "sessions": {
    "fontainebleau": {
      "config": {
        "ratedPhotoLimit": 15,
        "totalStarsLimit": 25,
        "defaultLayoutDesktop": "grid",
        "defaultLayoutMobile": "original",
        "defaultGridAspectRatio": "3/2"
      },
      "photos": {
        "introArticleMarkdown": "...",
        "photos": [
          { "id": 1, "url": "...", "caption": "..." },
          { "id": 2, "url": "...", "caption": "..." }
        ]
      },
      "votes": {
        "1": 0,
        "2": 0
      }
    },
    "st-genevieve": {
      "config": { "..."},
      "photos": { "..."},
      "votes":  { "..."}
    }
  }
}
```

### Настройка и миграция данных

1.  **Настройте Firebase**: Следуйте [инструкциям](https://firebase.google.com/docs/web/setup) для создания проекта и Realtime Database.

2.  **Используйте инструмент миграции**:
    *   Откройте файл `migration-tool.html` в вашем браузере.
    *   Введите **ID сессии** (например, `fontainebleau`). Этот ID будет использоваться в URL.
    *   Загрузите ваши локальные файлы `config.json` и `photos.json`.
    *   Инструмент сгенерирует JSON-структуру для одной сессии.
    *   Скопируйте сгенерированный JSON.

3.  **Импортируйте данные в Firebase**:
    *   Перейдите в вашу Realtime Database.
    *   Создайте корневой узел `sessions`.
    *   Внутри `sessions` создайте новый дочерний узел с вашим **ID сессии**.
    *   Импортируйте скопированный JSON в этот узел.

4.  **Настройте правила безопасности**: Для анонимного голосования установите следующие правила в вашей Realtime Database:
    ```json
    {
      "rules": {
        "sessions": {
          ".read": true, // Разрешить чтение списка сессий
          "$sessionId": {
            "config": { ".read": true, ".write": false },
            "photos": { ".read": true, ".write": false },
            "votes": {
              ".read": true,
              "$photo_id": {
                ".write": "newData.isNumber()"
              }
            }
          }
        }
      }
    }
    ```

5.  **Сконфигурируйте приложение**: Откройте файл `src/firebase.ts` и вставьте конфигурацию вашего веб-приложения Firebase.

### Управление данными

Старые HTML-инструменты (`admin.html`, `editor.html`) больше не используются. Управление конфигурацией и списком фотографий теперь осуществляется напрямую через **консоль Firebase**.