# Shutter Rank - Спецификация функционала

Этот документ описывает ключевые реализованные функции и требования к приложению Shutter Rank для обеспечения консистентности при тестировании и дальнейшей разработке.

## 1. Основное приложение (Голосование)

### 1.1. Управление сессиями
- Приложение поддерживает несколько независимых сессий голосования.
- Доступ к конкретной сессии осуществляется через хэш в URL (например, `index.html#session-name`).
- При отсутствии хэша пользователю отображается страница выбора из всех доступных сессий.
- В случае ошибки загрузки или отсутствия сессии отображается соответствующее сообщение.

### 1.2. Пользовательский интерфейс (UI)
- **Вступительная статья**: При первом входе в сессию отображается модальное окно с форматированной статьей (Markdown).
- **Два режима отображения ленты**:
    1.  **Сетка (Grid)**: Фотографии отображаются с фиксированными пропорциями (настраивается в `Settings`).
    2.  **Оригинальные пропорции (Original/Masonry)**: Фотографии отображаются с сохранением исходных пропорций в несколько колонок.
- **Адаптивность**: Интерфейс адаптирован для десктопных и мобильных устройств.
- **Настройки вида**: Пользователь может изменять режим отображения и пропорции сетки через модальное окно настроек. Выбор сохраняется в `localStorage`.

### 1.3. Процесс голосования
- **Система рейтинга**: 5-звёздочная система оценки.
- **Лимиты голосования**:
    - Ограничение на количество оцененных фотографий (`ratedPhotoLimit`).
    - Ограничение на общую сумму потраченных звёзд (`totalStarsLimit`).
- **Индикаторы лимитов**: В верхней части экрана отображается статистика по использованным лимитам.
- **Сохранение прогресса**: Голоса пользователя (рейтинги) сохраняются в Firebase Realtime Database в реальном времени под анонимным `userId` (хранится в `localStorage`).
- **Сброс голосов**: Пользователь может сбросить все свои оценки для текущей сессии.
- **Фото "вне конкурса"**: Такие фото имеют пунктирную обводку, и за них нельзя голосовать.

### 1.4. Динамический рейтинг (разблокировка 4-й и 5-й звезды)
- По умолчанию для оценки доступны только 1-3 звезды.
- 4-я и 5-я звезды визуально отличаются (пониженная прозрачность).
- Разблокировка 4-й и 5-й звезды происходит автоматически, если суммарный рейтинг фотографии (от всех пользователей) превышает средний рейтинг по сессии на определённый процент (`unlockFourStarsThresholdPercent`, `unlockFiveStarsThresholdPercent`).
- При попытке поставить "заблокированную" оценку появляется информационное модальное окно.

### 1.5. Группы фотографий (Стопки)
- **Объединение**: Фотографии можно объединять в группы (стопки).
- **Сложенное состояние**: В ленте группа отображается как одна карточка (обложка) с визуальным эффектом "стопки" и счётчиком фотографий.
- **Раскрытое состояние**:
    - По клику на стопку она плавно раскрывается прямо в ленте, сдвигая остальной контент.
    - Раскрытая группа имеет фон и рамку, а все остальные элементы ленты приглушаются, создавая "модальный" эффект.
    - Внутри отображаются все фотографии группы в виде полноценных карточек.
- **Выбор и оценка**:
    - На каждой фотографии в раскрытой группе есть контрол для выбора (кружок).
    - При выборе одной фотографии остальные приглушаются, а в заголовке группы появляется панель со звёздами для оценки.
    - Оценка, поставленная в заголовке, применяется к выбранной фотографии.
    - Выбор можно отменить повторным кликом, после чего все фото снова становятся яркими, а панель оценок исчезает.
- **Закрытие**: Раскрытую группу можно свернуть с помощью кнопки "Закрыть" в заголовке.

### 1.6. Режимы просмотра
- **Лента (Grid/Masonry)**: Основной вид.
- **Модальное окно (Desktop)**: По клику на фото открывается увеличенный просмотр с возможностью навигации (стрелки, клавиатура), оценки и просмотра описания.
- **Полноэкранный режим (Immersive)**:
    - На мобильных устройствах открывается по тапу на фото.
    - Поддерживает зацикленную навигацию свайпами (mobile) и стрелками (desktop).
    - Элементы управления плавно исчезают при бездействии и появляются при движении мыши.
- **Навигация по группам**:
    - **В общей ленте**: При просмотре в модальном/полноэкранном режиме группа представлена только одной фотографией (выбранной пользователем или первой по умолчанию). Листание сквозное.
    - **В раскрытой группе**: Если зайти в просмотр из раскрытой группы, навигация будет зациклена **только на фотографиях из этой группы**.
    - **Индикатор и "проваливание"**: В режиме просмотра у фото из группы отображается её название и кнопка "Выбрать другое", которая закрывает просмотр и раскрывает соответствующую группу в ленте.

## 2. Административные инструменты

### 2.1. Панель администратора (`admin.html`)
- Отображает список всех созданных сессий.
- Позволяет создать новую пустую сессию.
- Позволяет удалить существующую сессию (с подтверждением).
- Предоставляет быстрые ссылки для просмотра и редактирования каждой сессии.

### 2.2. Подготовка сессии (`prepare.html`)
- Инструмент для создания новой сессии из списка URL-адресов фотографий.
- **Создает полную структуру данных**: При сохранении формируется корректная структура сессии, включая `config`, `groups` и `order` для фотографий, что предотвращает ошибки в редакторе.
- Позволяет задать ID сессии, вступительную статью и отредактировать базовые описания для каждой фотографии перед сохранением в Firebase.

### 2.3. Редактор сессии (`editor.html`)
- Загружает данные существующей сессии из Firebase.
- **Автоматическая миграция**: При открытии сессии старого формата (без поля `order` у фото или объекта `groups`) редактор автоматически приводит данные к новому формату и предлагает их сохранить.
- Позволяет редактировать все параметры `config`.
- Позволяет редактировать вступительную статью.
- **Управление группами**: Позволяет создавать, удалять группы и привязывать фотографии к ним через выпадающий список.
- **Управление фотографиями**:
    - Редактирование URL и описания.
    - Добавление новых и удаление существующих фотографий.
    - Переупорядочивание фотографий с помощью перетаскивания (drag-and-drop).
- **Извлечение метаданных (EXIF)**: Позволяет автоматически извлечь описания из метаданных EXIF/IPTC для всех фотографий.
- **Экспорт в HTML**: Генерирует готовый HTML-файл для публикации.

## 3. Техническая реализация
- **Стек**: React, TypeScript, Vite, TailwindCSS.
- **База данных**: Firebase Realtime Database.
- **CI/CD**: Развертывание автоматизировано через GitHub Actions. Push в `dev` или `photo-groups-feature` -> dev-канал, push в `main` -> live-канал.