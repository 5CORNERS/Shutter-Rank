# Shutter Rank - Спецификация функционала

Этот документ описывает ключевые реализованные функции и требования к приложению Shutter Rank для обеспечения консистентности при тестировании и дальнейшей разработке.

## 1. Основное приложение (Голосование)

### 1.1. Управление сессиями
- Приложение поддерживает несколько независимых сессий голосования.
- Доступ к конкретной сессии осуществляется через хэш в URL (например, `index.html#session-name`).
- При отсутствии хэша пользователю отображается страница выбора из всех доступных сессий.
- В случае ошибки загрузки или отсутствия сессии отображается соответствующее сообщение.

### 1.2. Пользовательский интерфейс (UI)
- **Вступительная статья**: При первом входе в сессию отображается модальное окно с форматированной статьей (Markdown).
- **Два режима отображения ленты**:
    1.  **Сетка (Grid)**: Фотографии отображаются с фиксированными пропорциями (настраивается в `Settings`).
    2.  **Оригинальные пропорции (Original/Masonry)**: Фотографии отображаются с сохранением исходных пропорций в несколько колонок.
- **Адаптивность**: Интерфейс адаптирован для десктопных и мобильных устройств.
- **Настройки вида**: Пользователь может изменять режим отображения и пропорции сетки через модальное окно настроек. Выбор сохраняется в `localStorage`.

### 1.3. Процесс голосования
- **Система рейтинга**: 5-звёздочная система оценки.
- **Лимиты голосования**:
    - Ограничение на количество оцененных фотографий (`ratedPhotoLimit`).
    - Ограничение на общую сумму потраченных звёзд (`totalStarsLimit`).
- **Индикаторы лимитов**: В верхней части экрана отображается статистика по использованным лимитам.
- **Сохранение прогресса**: Голоса пользователя (рейтинги) сохраняются в Firebase Realtime Database в реальном времени под анонимным `userId` (хранится в `localStorage`).
- **Сброс голосов**: Пользователь может сбросить все свои оценки для текущей сессии.
- **Фото "вне конкурса"**: Такие фото имеют пунктирную обводку, и за них нельзя голосовать.

### 1.4. Динамический рейтинг (разблокировка 4-й и 5-й звезды)
- По умолчанию для оценки доступны только 1-3 звезды.
- 4-я и 5-я звезды визуально отличаются (пониженная прозрачность).
- Разблокировка 4-й и 5-й звезды происходит автоматически, если суммарный рейтинг фотографии (от всех пользователей) превышает средний рейтинг по сессии на определённый процент (`unlockFourStarsThresholdPercent`, `unlockFiveStarsThresholdPercent`).
- При попытке поставить "заблокированную" оценку появляется информационное модальное окно.

### 1.5. Взаимодействие с фотографиями
- **Отметки (флаги)**: Пользователь может отмечать фотографии флагом. Флаги сохраняются локально (`localStorage`).
- **Фильтр по отметкам**: Есть возможность скрыть неотмеченные фотографии из ленты.
- **Сортировка**: Ленту можно отсортировать по ID (порядковый номер) или по рейтингу (личному или общему, в зависимости от фазы).
- **Отображение оценок**:
    - Личные оценки (звёзды) пользователя всегда видны на карточке оцененной фотографии.
    - Красный крестик для сброса оценки появляется при наведении на всю карточку.
    - Общие оценки (суммарный балл) отображаются при переключении в режим "Показать общие".

### 1.6. Режимы просмотра
- **Лента (Grid/Masonry)**: Основной вид.
- **Модальное окно (Desktop)**: По клику на фото открывается увеличенный просмотр с возможностью навигации (стрелки, клавиатура), оценки и просмотра описания.
- **Полноэкранный режим (Immersive)**:
    - На мобильных устройствах открывается по тапу на фото. На десктопе — по клику на иконку "увеличить" из модального окна.
    - Поддерживает навигацию свайпами (mobile) и стрелками (desktop).
    - Закрывается свайпом вверх/вниз (mobile) или клавишей `Escape`.
    - Элементы управления (описание, рейтинг) скрываются по клику/тапу на фон. **Навигационные стрелки на десктопе остаются видимыми всегда.**
- **Информация о фото (Caption)**:
    - На карточке в ленте описание доступно по клику на иконку `(i)`.
    - **На мобильном**: если поповер с описанием открыт, любой тап за его пределами должен закрывать поповер, **не открывая** полноэкранный режим.

## 2. Административные инструменты

### 2.1. Панель администратора (`admin.html`)
- Отображает список всех созданных сессий.
- Позволяет создать новую пустую сессию.
- Позволяет удалить существующую сессию (с подтверждением).
- Предоставляет быстрые ссылки для просмотра и редактирования каждой сессии.

### 2.2. Подготовка сессии (`prepare.html`)
- Инструмент для создания новой сессии из списка URL-адресов фотографий.
- Позволяет задать ID сессии, вступительную статью и отредактировать базовые описания для каждой фотографии перед сохранением в Firebase.

### 2.3. Редактор сессии (`editor.html`)
- Загружает данные существующей сессии из Firebase.
- Позволяет редактировать все параметры `config`.
- Позволяет редактировать вступительную статью.
- **Управление фотографиями**:
    - Редактирование URL и описания.
    - Добавление новых и удаление существующих фотографий.
    - **Переупорядочивание фотографий**: Поддерживается перетаскивание (drag-and-drop) элементов списка. При перетаскивании к верхнему или нижнему краю экрана включается автоматическая прокрутка.
- **Извлечение метаданных**:
    - Специальная кнопка позволяет автоматически извлечь описания из метаданных EXIF/IPTC (`ImageDescription`) для всех фотографий.
    - Процесс обрабатывает ошибки (например, CORS) и предоставляет пользователю отчёт о результатах.
- **Экспорт в HTML**:
    - Кнопка "Скачать HTML" генерирует готовый HTML-файл для публикации.
    - Формат файла соответствует предоставленному образцу, включая теги `<figure>`, `<img>`, `<figcaption>` и встроенный JavaScript для адаптивной верстки подписей. `alt` текст изображения формируется как `[Описание] Фото: [Автор]`.
- Все изменения сохраняются в Firebase по нажатию кнопки "Сохранить".

## 3. Техническая реализация
- **Стек**: React, TypeScript, Vite, TailwindCSS.
- **База данных**: Firebase Realtime Database.
- **CI/CD**: Развертывание автоматизировано через GitHub Actions. Push в `firebase-integration` -> dev-канал, push в `main` -> live-канал.